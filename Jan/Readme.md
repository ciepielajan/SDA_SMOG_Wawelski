# SDA SMOG Wawelski - Rozkład jazdy

1 Załadowanie plików

0 data/april-2017.csv ,\
1 data/august-2017.csv ,\
2 data/december-2017.csv ,\
3 data/february-2017.csv ,\
4 data/january-2017.csv ,\
5 data/july-2017.csv ,\
6 data/june-2017.csv ,\
7 data/march-2017.csv ,\
8 data/may-2017.csv ,\
9 data/november-2017.csv ,\
10 data/october-2017.csv ,\
11 data/september-2017.csv ,\

|    | UTC time            |   3_temperature |   3_humidity |   3_pressure |   3_pm1 |   3_pm25 |   3_pm10 |   140_temperature |   140_humidity |   140_pressure |   140_pm1 |   140_pm25 |   140_pm10 |   142_temperature |   142_humidity |   142_pressure |   142_pm1 |   142_pm25 |   142_pm10 |   147_temperature |   147_humidity |   147_pressure |   147_pm1 |   147_pm25 |   147_pm10 |   169_temperature |   169_humidity |   169_pressure |   169_pm1 |   169_pm25 |   169_pm10 |   170_temperature |   170_humidity |   170_pressure |   170_pm1 |   170_pm25 |   170_pm10 |   171_temperature |   171_humidity |   171_pressure |   171_pm1 |   171_pm25 |   171_pm10 |   172_temperature |   172_humidity |   172_pressure |   172_pm1 |   172_pm25 |   172_pm10 |   173_temperature |   173_humidity |   173_pressure |   173_pm1 |   173_pm25 |   173_pm10 |   174_temperature |   174_humidity |   174_pressure |   174_pm1 |   174_pm25 |   174_pm10 |   176_temperature |   176_humidity |   176_pressure |   176_pm1 |   176_pm25 |   176_pm10 |   177_temperature |   177_humidity |   177_pressure |   177_pm1 |   177_pm25 |   177_pm10 |   178_temperature |   178_humidity |   178_pressure |   178_pm1 |   178_pm25 |   178_pm10 |   179_temperature |   179_humidity |   179_pressure |   179_pm1 |   179_pm25 |   179_pm10 |   180_temperature |   180_humidity |   180_pressure |   180_pm1 |   180_pm25 |   180_pm10 |   181_temperature |   181_humidity |   181_pressure |   181_pm1 |   181_pm25 |   181_pm10 |   182_temperature |   182_humidity |   182_pressure |   182_pm1 |   182_pm25 |   182_pm10 |   183_temperature |   183_humidity |   183_pressure |   183_pm1 |   183_pm25 |   183_pm10 |   184_temperature |   184_humidity |   184_pressure |   184_pm1 |   184_pm25 |   184_pm10 |   185_temperature |   185_humidity |   185_pressure |   185_pm1 |   185_pm25 |   185_pm10 |   187_temperature |   187_humidity |   187_pressure |   187_pm1 |   187_pm25 |   187_pm10 |   189_temperature |   189_humidity |   189_pressure |   189_pm1 |   189_pm25 |   189_pm10 |   192_temperature |   192_humidity |   192_pressure |   192_pm1 |   192_pm25 |   192_pm10 |   194_temperature |   194_humidity |   194_pressure |   194_pm1 |   194_pm25 |   194_pm10 |   195_temperature |   195_humidity |   195_pressure |   195_pm1 |   195_pm25 |   195_pm10 |   196_temperature |   196_humidity |   196_pressure |   196_pm1 |   196_pm25 |   196_pm10 |   201_temperature |   201_humidity |   201_pressure |   201_pm1 |   201_pm25 |   201_pm10 |   202_temperature |   202_humidity |   202_pressure |   202_pm1 |   202_pm25 |   202_pm10 |   203_temperature |   203_humidity |   203_pressure |   203_pm1 |   203_pm25 |   203_pm10 |   204_temperature |   204_humidity |   204_pressure |   204_pm1 |   204_pm25 |   204_pm10 |   205_temperature |   205_humidity |   205_pressure |   205_pm1 |   205_pm25 |   205_pm10 |   208_temperature |   208_humidity |   208_pressure |   208_pm1 |   208_pm25 |   208_pm10 |   209_temperature |   209_humidity |   209_pressure |   209_pm1 |   209_pm25 |   209_pm10 |   210_temperature |   210_humidity |   210_pressure |   210_pm1 |   210_pm25 |   210_pm10 |   211_temperature |   211_humidity |   211_pressure |   211_pm1 |   211_pm25 |   211_pm10 |   212_temperature |   212_humidity |   212_pressure |   212_pm1 |   212_pm25 |   212_pm10 |   213_temperature |   213_humidity |   213_pressure |   213_pm1 |   213_pm25 |   213_pm10 |   214_temperature |   214_humidity |   214_pressure |   214_pm1 |   214_pm25 |   214_pm10 |   215_temperature |   215_humidity |   215_pressure |   215_pm1 |   215_pm25 |   215_pm10 |   216_temperature |   216_humidity |   216_pressure |   216_pm1 |   216_pm25 |   216_pm10 |   218_temperature |   218_humidity |   218_pressure |   218_pm1 |   218_pm25 |   218_pm10 |   219_temperature |   219_humidity |   219_pressure |   219_pm1 |   219_pm25 |   219_pm10 |   220_temperature |   220_humidity |   220_pressure |   220_pm1 |   220_pm25 |   220_pm10 |   221_temperature |   221_humidity |   221_pressure |   221_pm1 |   221_pm25 |   221_pm10 |   222_temperature |   222_humidity |   222_pressure |   222_pm1 |   222_pm25 |   222_pm10 |   223_temperature |   223_humidity |   223_pressure |   223_pm1 |   223_pm25 |   223_pm10 |   225_temperature |   225_humidity |   225_pressure |   225_pm1 |   225_pm25 |   225_pm10 |   226_temperature |   226_humidity |   226_pressure |   226_pm1 |   226_pm25 |   226_pm10 |   227_temperature |   227_humidity |   227_pressure |   227_pm1 |   227_pm25 |   227_pm10 |   228_temperature |   228_humidity |   228_pressure |   228_pm1 |   228_pm25 |   228_pm10 |   263_temperature |   263_humidity |   263_pressure |   263_pm1 |   263_pm25 |   263_pm10 |   622_temperature |   622_humidity |   622_pressure |   622_pm1 |   622_pm25 |   622_pm10 |   713_temperature |   713_humidity |   713_pressure |   713_pm1 |   713_pm25 |   713_pm10 |   808_temperature |   808_humidity |   808_pressure |   808_pm1 |   808_pm25 |   808_pm10 |   857_temperature |   857_humidity |   857_pressure |   857_pm1 |   857_pm25 |   857_pm10 |   895_temperature |   895_humidity |   895_pressure |   895_pm1 |   895_pm25 |   895_pm10 |
|---:|:--------------------|----------------:|-------------:|-------------:|--------:|---------:|---------:|------------------:|---------------:|---------------:|----------:|-----------:|-----------:|------------------:|---------------:|---------------:|----------:|-----------:|-----------:|------------------:|---------------:|---------------:|----------:|-----------:|-----------:|------------------:|---------------:|---------------:|----------:|-----------:|-----------:|------------------:|---------------:|---------------:|----------:|-----------:|-----------:|------------------:|---------------:|---------------:|----------:|-----------:|-----------:|------------------:|---------------:|---------------:|----------:|-----------:|-----------:|------------------:|---------------:|---------------:|----------:|-----------:|-----------:|------------------:|---------------:|---------------:|----------:|-----------:|-----------:|------------------:|---------------:|---------------:|----------:|-----------:|-----------:|------------------:|---------------:|---------------:|----------:|-----------:|-----------:|------------------:|---------------:|---------------:|----------:|-----------:|-----------:|------------------:|---------------:|---------------:|----------:|-----------:|-----------:|------------------:|---------------:|---------------:|----------:|-----------:|-----------:|------------------:|---------------:|---------------:|----------:|-----------:|-----------:|------------------:|---------------:|---------------:|----------:|-----------:|-----------:|------------------:|---------------:|---------------:|----------:|-----------:|-----------:|------------------:|---------------:|---------------:|----------:|-----------:|-----------:|------------------:|---------------:|---------------:|----------:|-----------:|-----------:|------------------:|---------------:|---------------:|----------:|-----------:|-----------:|------------------:|---------------:|---------------:|----------:|-----------:|-----------:|------------------:|---------------:|---------------:|----------:|-----------:|-----------:|------------------:|---------------:|---------------:|----------:|-----------:|-----------:|------------------:|---------------:|---------------:|----------:|-----------:|-----------:|------------------:|---------------:|---------------:|----------:|-----------:|-----------:|------------------:|---------------:|---------------:|----------:|-----------:|-----------:|------------------:|---------------:|---------------:|----------:|-----------:|-----------:|------------------:|---------------:|---------------:|----------:|-----------:|-----------:|------------------:|---------------:|---------------:|----------:|-----------:|-----------:|------------------:|---------------:|---------------:|----------:|-----------:|-----------:|------------------:|---------------:|---------------:|----------:|-----------:|-----------:|------------------:|---------------:|---------------:|----------:|-----------:|-----------:|------------------:|---------------:|---------------:|----------:|-----------:|-----------:|------------------:|---------------:|---------------:|----------:|-----------:|-----------:|------------------:|---------------:|---------------:|----------:|-----------:|-----------:|------------------:|---------------:|---------------:|----------:|-----------:|-----------:|------------------:|---------------:|---------------:|----------:|-----------:|-----------:|------------------:|---------------:|---------------:|----------:|-----------:|-----------:|------------------:|---------------:|---------------:|----------:|-----------:|-----------:|------------------:|---------------:|---------------:|----------:|-----------:|-----------:|------------------:|---------------:|---------------:|----------:|-----------:|-----------:|------------------:|---------------:|---------------:|----------:|-----------:|-----------:|------------------:|---------------:|---------------:|----------:|-----------:|-----------:|------------------:|---------------:|---------------:|----------:|-----------:|-----------:|------------------:|---------------:|---------------:|----------:|-----------:|-----------:|------------------:|---------------:|---------------:|----------:|-----------:|-----------:|------------------:|---------------:|---------------:|----------:|-----------:|-----------:|------------------:|---------------:|---------------:|----------:|-----------:|-----------:|------------------:|---------------:|---------------:|----------:|-----------:|-----------:|------------------:|---------------:|---------------:|----------:|-----------:|-----------:|------------------:|---------------:|---------------:|----------:|-----------:|-----------:|------------------:|---------------:|---------------:|----------:|-----------:|-----------:|------------------:|---------------:|---------------:|----------:|-----------:|-----------:|------------------:|---------------:|---------------:|----------:|-----------:|-----------:|------------------:|---------------:|---------------:|----------:|-----------:|-----------:|
|  0 | 2017-12-01T00:00:00 |             nan |          nan |          nan |     nan |      nan |      nan |                 0 |             96 |         100542 |        39 |         38 |         68 |               nan |            nan |            nan |       nan |        nan |        nan |               nan |            nan |            nan |       nan |        nan |        nan |               -11 |             70 |         100479 |        25 |         23 |         40 |                 0 |             72 |         100527 |        29 |         28 |         48 |                 0 |             96 |         100531 |        32 |         30 |         52 |                 0 |             72 |         100542 |        32 |         31 |         53 |                 0 |             97 |         100536 |        29 |         29 |         47 |                 0 |             97 |         100495 |        32 |         30 |         51 |                 0 |             96 |         100602 |        28 |         26 |         51 |                 0 |             97 |         100540 |        34 |         33 |         55 |               nan |            nan |            nan |       nan |        nan |        nan |                 0 |             96 |         100635 |        34 |         34 |         56 |                 0 |             97 |         100679 |        25 |         22 |         37 |                 0 |             97 |         100597 |        30 |         29 |         50 |                 0 |             95 |         100568 |        28 |         26 |         43 |                 0 |             96 |         100569 |        28 |         28 |         46 |                 0 |             97 |         100548 |        29 |         26 |         44 |                 0 |             97 |         100568 |        34 |         32 |         55 |               nan |            nan |            nan |       nan |        nan |        nan |                 0 |             97 |         100598 |        28 |         26 |         42 |                 0 |             96 |         100538 |        34 |         33 |         56 |                 1 |          -2442 |         100399 |        30 |         29 |         50 |                 0 |             90 |         100638 |        32 |         32 |         53 |                 0 |             97 |         100659 |        27 |         26 |         42 |                 1 |             97 |         100630 |        31 |         29 |         50 |                 0 |             97 |         100772 |        30 |         27 |         42 |                 0 |             97 |            nan |        31 |         29 |         49 |                 1 |             97 |         100571 |        31 |         31 |         53 |               nan |            nan |            nan |       nan |        nan |        nan |                 0 |             92 |         100564 |        31 |         30 |         52 |                 0 |             96 |         100373 |        29 |         28 |         47 |                 1 |             97 |         100537 |        27 |         25 |         41 |               nan |            nan |            nan |       nan |        nan |        nan |                 0 |             85 |         100448 |        27 |         26 |         43 |               nan |            nan |            nan |       nan |        nan |        nan |                 0 |             97 |         100629 |        36 |         36 |         62 |                 0 |             96 |         100583 |        27 |         26 |         43 |                 0 |             91 |         100683 |        31 |         29 |         49 |                 0 |             97 |         100720 |        28 |         27 |         44 |                 0 |             96 |         100584 |        30 |         28 |         48 |                 1 |             92 |         100516 |        30 |         28 |         49 |                 0 |             96 |         100533 |        30 |         29 |         50 |                 0 |             95 |         100479 |        31 |         28 |         46 |                 0 |             97 |         100637 |        28 |         27 |         47 |                 0 |             97 |         100572 |        29 |         27 |         44 |                 0 |             86 |         100537 |        27 |         24 |         40 |               nan |            nan |            nan |       nan |        nan |        nan |                 0 |             97 |         100616 |        27 |         25 |         41 |                 0 |             97 |         100602 |        25 |         21 |         35 |                 0 |             97 |         100810 |        34 |         33 |         62 |                 5 |             97 |         100036 |        12 |         10 |         18 |               nan |            nan |            nan |       nan |        nan |        nan |                 0 |             88 |         100554 |        32 |         33 |         74 |                 0 |             94 |         100607 |        34 |         36 |         66 |



sensor_locations.csv

|    |   id |   latitude |   longitude |
|---:|-----:|-----------:|------------:|
|  0 |    3 |    50.0577 |     19.9614 |
|  1 |  140 |    50.0577 |     19.9614 |
|  2 |  142 |    50.0848 |     19.8781 |

2 Połączenie wszystkich df


3 Transformacja df







3.2 Połaczenie wartości z konkretnymi lokalizacjami wg ID sensoru

|    | UTC time            |   temperature |   humidity |   pressure |   pm1 |   pm25 |   pm10 |   id |   latitude |   longitude |
|---:|:--------------------|--------------:|-----------:|-----------:|------:|-------:|-------:|-----:|-----------:|------------:|
|  0 | 2017-01-01 00:00:00 |           nan |        nan |        nan |   nan |    nan |    nan |  140 |    50.0577 |     19.9614 |
|  1 | 2017-01-01 01:00:00 |           nan |        nan |        nan |   nan |    nan |    nan |  140 |    50.0577 |     19.9614 |
|  2 | 2017-01-01 02:00:00 |           nan |        nan |        nan |   nan |    nan |    nan |  140 |    50.0577 |     19.9614 |

4 EDA

> wymiary zbioru danych: (481 208, 10)

4.1. Ile jest Nan w danych kolumnach

|             |      0 |
|:------------|-------:|
| UTC time    |      0 |
| temperature | 109558 |
| humidity    | 109638 |
| pressure    | 172529 |
| pm1         |  92854 |
| pm25        |  92835 |
| pm10        |  92832 |
| id          |      0 |
| latitude    |      0 |
| longitude   |      0 |

4.2. Czy można znaleźć brakujące dane lub czymś je zastąpić

> Sprawdzam zachowanie podelu po usunięciu wszysktich wartośći Nan. Ilość wymiarów po usunięciut to: (291754, 10)

4.3. Jakie zastosować normy i ich zakresy dla stężenia pm10 w celu określenia jakości powietrza

|       |        pm10 |
|:------|------------:|
| count | 291754      |
| mean  |     49.5892 |
| std   |     53.3795 |
| min   |     -1      |
| 40%   |     26      |
| 50%   |     34      |
| 75%   |     61      |
| 90%   |    102      |
| 95%   |    154      |
| 99%   |    282      |
| max   |    664      |

Wnioski
> podejrzana wartość to `min = -1`. Poziom stężenia nie może być ujemny. Dane prawdopodobnie wymagają dalszego oczyszczenia. 

> niepokojąca jest też wartość `max=664` . Normy zaczynają sie od 25 a kończna na 150 .  Czy dla wartości powyżej 200 powinniśmy przyjąć własne normy ?

> Istotny jest fakt że 99% danych mieści się w zakresie od 0 do 282.  

> przyjęte normy i ich zakresy to 50/100/150.   Na powyższym wykresie widać wartości powyżej 200 a nawet 600. Czy są tą błędy pomiarowe czy i dla nich zrobić klasyfikację. Poniżej sprawdzę zakresy dla konkretnej stacji. 

> Źródła zgodnie podają że stan powyżej 100 dla pm10 jest "alarmujący". Z uwagi że podaczas wysiku fizycznego na świerzym powietrzu pobiera się wiecej powietrza niż przy zwykłej aktywnośći uznaję że wszytkie pomiary powyżej 100 będą uznawane za szkodliwe dla zdrowia. 

> Zakresy dla PM10 które będę w dalszych krokach prowadziło to 0,25,50,100,150

5 Zmiana danych na kategoryczne - Rozbicie TimeSeries na dzień, miesiąc etc

|      | UTC time            |   temperature |   humidity |   pressure |   pm1 |   pm25 |   pm10 |   id |   latitude |   longitude |   M |   D |   H |
|-----:|:--------------------|--------------:|-----------:|-----------:|------:|-------:|-------:|-----:|-----------:|------------:|----:|----:|----:|
| 1811 | 2017-03-17 11:00:00 |            12 |         44 |     101244 |    16 |     10 |     22 |  140 |    50.0577 |     19.9614 |   3 |  17 |  11 |
| 1812 | 2017-03-17 12:00:00 |            12 |         45 |     101147 |    18 |     12 |     26 |  140 |    50.0577 |     19.9614 |   3 |  17 |  12 |
| 1813 | 2017-03-17 13:00:00 |            12 |         43 |     101049 |    18 |     12 |     26 |  140 |    50.0577 |     19.9614 |   3 |  17 |  13 |

6 Normalizacja współrzędnych - Standard scaller lub wzór (-50x1000)

> Brak

7 Predykcja - szukanie najlepszego modelu

7.1 Regression

> Podusmowanie data processing: usunięte wszystkie nulle, wartości bez normalizacji, dodatkowe cechy to: miesiac, dzień, godzina. Dane nie zostały podzielone na zbiór treningowy i testowy. 

7.1.1 Regresja liniowa

7.1.1.2 Regresja liniowa Podstawowy model

> Model przewidział wartość P10 = 1.60 , podczas gdy prawidłowa wartość to 6.00 . Uznaje że jest to marginalna pomyłka. Jutro sprawdzę predykcje na innych modelach oraz zastosuję metryki oceny predykcji modelów  aby mieć co porównywać

7.1.1.3 Regresja liniowa - Dostrajanie modelu np grid search

7.1.2.1 RandomForestRegressor()

7.1.2.2 RandomForestRegressor() - Podstawowy model

> Model przewidział wartość P10 = 6.37 , podczas gdy prawidłowa wartość to 6.00 . Uznaje że jest to marginalna pomyłka. Jutro sprawdzę predykcje na innych modelach oraz zastosuję metryki oceny predykcji modelów  aby mieć co porównywać

7.1.2.3 RandomForestRegressor() - Dostrajanie modelu np grid search

7.2 Predykcja TimeSeries

7.2.1 arima (pmd arima auto-arima)

7.2.2 Profet

7.3 RNN

7.3.1 LSTM

7.3.1.1 LSTM - Podstawowy

7.3.1.2 LSTM - Dwukierunkowy

7.3.2 GRU

7.3.2.1 GRU - Podstawowy

7.3.2.2 GRU - Dwukierunkowy

8 Zestawienie wyników predykcji - wybranie najlepszego modelu do predykcji 

9 Obliczenie predykcji dla nowej daty dla wszystkich punktów pomiarowych 

10 Prototyp

10.1 Utworzenie siatki punktów w na terenie całego krakowa zlokalizowanych co 500m

10.2 Obliczenie predykcji dla wszystkich stacji pomiarowych dla konkretnej daty

> zastanawiam się czy model nie został przeuczony dla  wartości z małym stężeniem. Sprawdziłem proporacje w zbiorze i 40% wartości dla pm10 sa z zakresu 0-26.   Może trzeba pomyśleć o upsample/downsample . Nie pamiętam czy przy predykcji można ją stosować.    Co myślicie ?  Skoro ustalimy wcześniej zakrsy to może przerzucić się na klasyfikacje a nie regresję ?

> aby upewnić się trzeba zastosować predykcję dla dnia w którym na pewno było wysokie stęrzenie pm10

10.3 Utworzenie modelu K-najbliższych sąsiadów -regression (odległość, haversine distance- odległość km )




#### Inspiracja:

K-najbliższych sąsiadów -regression (odległość, haversine distance- odległość km )  
https://scikit-learn.org/stable/modules/generated/sklearn.metrics.pairwise.haversine_distances.html 
https://stackoverflow.com/a/29958276


Wyznaczenie punktów -   haversine distance 

https://stackoverflow.com/a/40343603   

